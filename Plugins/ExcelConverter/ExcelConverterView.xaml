<UserControl x:Class="GadgetTools.Plugins.ExcelConverter.ExcelConverterView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="650" d:DesignWidth="700">
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 変換モード選択 -->
        <GroupBox Grid.Row="0" Header="変換モード" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <RadioButton Content="単一ファイル" IsChecked="{Binding IsSingleFileMode}" Margin="0,0,20,0"/>
                <RadioButton Content="複数ファイル一括変換" IsChecked="{Binding IsSingleFileMode, Converter={StaticResource BooleanInverseConverter}}"/>
            </StackPanel>
        </GroupBox>
        
        <!-- ファイルソース選択 -->
        <GroupBox Grid.Row="1" Header="ファイルソース" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <RadioButton Content="ローカルファイル" IsChecked="{Binding IsLocalFileMode}" Margin="0,0,20,0"/>
                <RadioButton Content="SharePoint URL" IsChecked="{Binding IsLocalFileMode, Converter={StaticResource BooleanInverseConverter}}"/>
            </StackPanel>
        </GroupBox>

        <!-- ファイル選択 -->
        <GroupBox Grid.Row="2" Header="Excelファイル選択" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- SharePoint URL入力 -->
                <Grid Grid.Row="0" Visibility="{Binding IsLocalFileMode, Converter={StaticResource BooleanToVisibilityInverseConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="SharePoint URL:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBox Grid.Column="1" Text="{Binding SharePointUrl}" Margin="0,0,10,0" 
                             ToolTip="SharePointファイルの完全なURLを入力してください"/>
                    <Button Grid.Column="2" Content="接続" Width="80" Command="{Binding ConnectSharePointCommand}"/>
                </Grid>

                <!-- 単一ファイル選択 -->
                <Grid Grid.Row="1" Visibility="{Binding IsSingleFileMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" Text="{Binding FilePath}" Margin="0,0,10,0" IsReadOnly="True"/>
                    <Button Grid.Column="1" Content="参照..." Width="80" Command="{Binding BrowseFileCommand}"/>
                </Grid>
                
                <!-- 複数ファイル選択 -->
                <Grid Grid.Row="2" Visibility="{Binding IsSingleFileMode, Converter={StaticResource BooleanToVisibilityInverseConverter}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="100"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0" Margin="0,0,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="ファイル追加..." Width="100" Margin="0,0,10,0" Command="{Binding AddFilesCommand}"/>
                        <Button Grid.Column="1" Content="クリア" Width="80" Margin="0,0,10,0" Command="{Binding ClearFilesCommand}"/>
                    </Grid>
                    <ListBox Grid.Row="1" ItemsSource="{Binding SelectedFiles}" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="2" Text="{Binding SelectedFiles.Count, StringFormat='選択ファイル数: {0}'}" FontSize="12" Foreground="Gray"/>
                </Grid>
            </Grid>
        </GroupBox>

        <!-- シート選択 -->
        <GroupBox Grid.Row="3" Header="シート選択" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <RadioButton Grid.Column="0" Content="全シート" IsChecked="{Binding IsAllSheets}" Margin="0,0,20,0"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <RadioButton Content="特定シート:" IsChecked="{Binding IsAllSheets, Converter={StaticResource BooleanInverseConverter}}" Margin="0,0,10,0"/>
                    <ComboBox ItemsSource="{Binding SheetNames}" SelectedItem="{Binding SelectedSheet}" Width="200" 
                              IsEnabled="{Binding IsAllSheets, Converter={StaticResource BooleanInverseConverter}}"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- 出力形式選択 -->
        <GroupBox Grid.Row="4" Header="出力形式" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <RadioButton Content="Markdown (.md)" IsChecked="{Binding SelectedOutputFormat, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Markdown}" Margin="0,0,20,0"/>
                <RadioButton Content="CSV (.csv)" IsChecked="{Binding SelectedOutputFormat, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=CSV}" Margin="0,0,20,0"/>
                <RadioButton Content="JSON (.json)" IsChecked="{Binding SelectedOutputFormat, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=JSON}" Margin="0,0,20,0"/>
                <RadioButton Content="HTML (.html)" IsChecked="{Binding SelectedOutputFormat, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=HTML}" Margin="0,0,20,0"/>
            </StackPanel>
        </GroupBox>

        <!-- 出力設定 -->
        <GroupBox Grid.Row="5" Header="出力設定" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- 単一ファイル用出力設定 -->
                <Grid Grid.Row="0" Visibility="{Binding IsSingleFileMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <RadioButton Grid.Row="0" Content="画面に表示" IsChecked="{Binding IsDisplayMode}" Margin="0,0,0,5"/>
                    <StackPanel Grid.Row="1" Orientation="Horizontal">
                        <RadioButton Content="ファイルに保存:" IsChecked="{Binding IsDisplayMode, Converter={StaticResource BooleanInverseConverter}}" Margin="0,0,10,0"/>
                        <TextBox Text="{Binding OutputFilePath}" Width="300" IsEnabled="{Binding IsDisplayMode, Converter={StaticResource BooleanInverseConverter}}" Margin="0,0,10,0"/>
                        <Button Content="参照..." Width="80" IsEnabled="{Binding IsDisplayMode, Converter={StaticResource BooleanInverseConverter}}" Command="{Binding BrowseOutputFileCommand}"/>
                    </StackPanel>
                </Grid>
                
                <!-- 複数ファイル用出力設定 -->
                <Grid Grid.Row="1" Visibility="{Binding IsSingleFileMode, Converter={StaticResource BooleanToVisibilityInverseConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="出力フォルダ:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBox Grid.Column="1" Text="{Binding OutputFolderPath}" IsReadOnly="True" Margin="0,0,10,0"/>
                    <Button Grid.Column="2" Content="参照..." Width="80" Command="{Binding BrowseOutputFolderCommand}"/>
                </Grid>
            </Grid>
        </GroupBox>

        <!-- 変換ボタンと進行状況 -->
        <GroupBox Grid.Row="6" Header="変換" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Button Grid.Row="0" Content="変換実行" Height="40" Margin="0,0,0,10" Command="{Binding ConvertCommand}"/>
                <ProgressBar Grid.Row="1" Value="{Binding ProgressValue}" Height="20" 
                             Visibility="{Binding IsProgressVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </GroupBox>

        <!-- プレビュー -->
        <GroupBox Grid.Row="7" Header="プレビュー" Margin="0,0,0,10">
            <ScrollViewer>
                <TextBox Text="{Binding PreviewContent}" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" 
                         VerticalScrollBarVisibility="Auto" FontFamily="Consolas" FontSize="12" Background="#F5F5F5"/>
            </ScrollViewer>
        </GroupBox>

        <!-- ステータス -->
        <StatusBar Grid.Row="8">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal">
                    <ProgressBar Width="100" Height="16" IsIndeterminate="True" Margin="0,0,5,0"/>
                    <TextBlock Text="処理中..." FontSize="11"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>