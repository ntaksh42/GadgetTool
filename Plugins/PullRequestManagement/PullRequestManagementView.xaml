<UserControl x:Class="GadgetTools.Plugins.PullRequestManagement.PullRequestManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:GadgetTools.Plugins.PullRequestManagement"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">
    
    <UserControl.Resources>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:BooleanInverseConverter x:Key="BooleanInverseConverter"/>
        <local:BooleanToColorConverter x:Key="BooleanToColorConverter"/>
        <local:BooleanToConnectionStatusConverter x:Key="BooleanToConnectionStatusConverter"/>
        <local:ConflictStatusConverter x:Key="ConflictStatusConverter"/>
        
        <!-- Expanderのカスタムスタイル -->
        <Style TargetType="Expander">
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <Style TargetType="Border" x:Key="ExpanderContentBorder">
            <Setter Property="BorderBrush" Value="#E1E1E1"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Background" Value="#FAFAFA"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,5,0,0"/>
        </Style>
    </UserControl.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" MinHeight="400"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Azure DevOps Configuration -->
        <Expander Grid.Row="0" Header="Azure DevOps Configuration" IsExpanded="False">
            <Border Style="{StaticResource ExpanderContentBorder}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 共通設定ステータス -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Global Config:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                    <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,5">
                        <Ellipse Width="10" Height="10" Margin="0,0,5,0">
                            <Ellipse.Fill>
                                <SolidColorBrush Color="{Binding IsSharedConfigured, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                            </Ellipse.Fill>
                        </Ellipse>
                        <TextBlock Text="{Binding Organization, Mode=OneWay}" FontWeight="Medium" Margin="0,0,5,0"/>
                        <TextBlock Text="(" Foreground="Gray"/>
                        <TextBlock Text="{Binding IsSharedConfigured, Mode=OneWay, Converter={StaticResource BooleanToConnectionStatusConverter}}" Foreground="Gray"/>
                        <TextBlock Text=")" Foreground="Gray"/>
                    </StackPanel>
                    <Button Grid.Row="0" Grid.Column="2" Grid.ColumnSpan="2" Content="⚙ Global Settings" Width="120" HorizontalAlignment="Right" Margin="5,0,0,5" 
                            Click="GlobalSettings_Click" ToolTip="Configure shared Azure DevOps settings"/>
                    
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Project:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Project}" Margin="0,0,10,5"
                             ToolTip="Project name in your Azure DevOps organization"/>
                    
                    <TextBlock Grid.Row="1" Grid.Column="2" Text="Repository:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                    <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding Repository}" Margin="0,0,0,5"
                             ToolTip="Repository name"/>
                </Grid>
            </Border>
        </Expander>
        
        <!-- Actions and Filters -->
        <Expander Grid.Row="1" Header="Actions and Filters" IsExpanded="True">
            <Border Style="{StaticResource ExpanderContentBorder}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="Load Pull Requests" Padding="10,5" Command="{Binding LoadPullRequestsCommand}"/>
                        <Button Content="Refresh" Padding="10,5" Margin="10,0,0,0" Command="{Binding RefreshCommand}"/>
                        
                        <!-- Quick Filters -->
                        <TextBlock Text="Quick Filters:" VerticalAlignment="Center" FontWeight="Bold" Margin="20,0,5,0"/>
                        <Button Content="My PRs" Padding="8,3" Margin="5,0" Command="{Binding QuickFilterMyPRsCommand}" 
                                ToolTip="Show only PRs created by me"/>
                        <Button Content="Active" Padding="8,3" Margin="5,0" Command="{Binding QuickFilterActiveCommand}" 
                                ToolTip="Show only active PRs"/>
                        <Button Content="Needs Review" Padding="8,3" Margin="5,0" Command="{Binding QuickFilterNeedsReviewCommand}" 
                                ToolTip="Show PRs waiting for review"/>
                        <Button Content="Approved" Padding="8,3" Margin="5,0" Command="{Binding QuickFilterApprovedCommand}" 
                                ToolTip="Show approved PRs"/>
                        
                        <Separator Margin="10,0"/>
                        
                        <Button Content="🎯 Advanced" Padding="8,3" Margin="5,0" Command="{Binding ShowAdvancedFilterCommand}" 
                                ToolTip="Open advanced filtering options"/>
                        <Button Content="🔍 Global" Padding="8,3" Margin="5,0" Command="{Binding ShowGlobalSearchCommand}" 
                                ToolTip="Search across all plugins"/>
                    </StackPanel>
                    
                    <!-- Basic Filters -->
                    <Grid Grid.Row="1" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="Author:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Grid.Column="1" Text="{Binding AuthorFilter, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,10,0" 
                                 ToolTip="Filter by pull request author"/>
                        
                        <TextBlock Grid.Column="2" Text="Target:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Grid.Column="3" Text="{Binding TargetBranchFilter, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,10,0" 
                                 ToolTip="Filter by target branch"/>
                        
                        <TextBlock Grid.Column="4" Text="From Date:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <DatePicker Grid.Column="5" SelectedDate="{Binding FromDate}" Margin="0,0,10,0" 
                                   ToolTip="Filter pull requests from this date"/>
                        
                        <TextBlock Grid.Column="6" Text="Status:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <ComboBox Grid.Column="7" ItemsSource="{Binding StatusOptions}" SelectedItem="{Binding SelectedStatus}" 
                                  ToolTip="Filter by PR status"/>
                    </Grid>
                    
                    <!-- Advanced Filters -->
                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,10,0" 
                                 ToolTip="Search by Title or Created By"/>
                        
                        <TextBlock Grid.Column="2" Text="File Type:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Grid.Column="3" Text="{Binding FileExtensionFilter, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,10,0" 
                                 ToolTip="Filter by file extension (e.g., .cs, .js)"/>
                        
                        <TextBlock Grid.Column="4" Text="Min Changes:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Grid.Column="5" Text="{Binding MinChangesFilter, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,10,0" 
                                 ToolTip="Minimum number of file changes"/>
                        
                        <Button Grid.Column="6" Content="Clear All" Padding="8,3" Command="{Binding ClearAllFiltersCommand}"/>
                    </Grid>
                </Grid>
            </Border>
        </Expander>
        
        <!-- Results and Details -->
        <Border Grid.Row="2" BorderBrush="#D1D1D1" BorderThickness="1" Background="White" CornerRadius="4" Margin="0,0,0,10">
            <DockPanel>
                <Border DockPanel.Dock="Top" Background="#F5F5F5" BorderBrush="#D1D1D1" BorderThickness="0,0,0,1" Padding="15,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Pull Requests and Details" FontWeight="Bold" FontSize="14" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="▲ Collapse All" x:Name="CollapseAllButton" 
                                    Click="CollapseAll_Click" Margin="0,0,5,0" 
                                    Padding="8,3" FontSize="11" 
                                    ToolTip="Collapse all sections to maximize results area"/>
                            <Button Content="▼ Expand All" x:Name="ExpandAllButton" 
                                    Click="ExpandAll_Click" 
                                    Padding="8,3" FontSize="11"
                                    ToolTip="Expand all sections"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*" MinWidth="500"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="2*" MinWidth="350"/>
                    </Grid.ColumnDefinitions>
            
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Filter Controls -->
                <Grid Grid.Row="0" Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Filter:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Search in PR titles, descriptions, and author names"/>
                    <Button Grid.Column="2" Content="Clear" Width="50" 
                            Margin="5,0,0,0" Command="{Binding ClearAllFiltersCommand}"/>
                    <Button Grid.Column="3" Content="Clear Column Filters" Width="120" 
                            Margin="5,0,0,0" Command="{Binding ClearColumnFiltersCommand}"
                            ToolTip="Clear all column filters"/>
                    <Button Grid.Column="4" Content="Columns..." Width="80" 
                            Margin="5,0,0,0" Command="{Binding ShowColumnVisibilityCommand}"
                            ToolTip="Show/hide columns"/>
                    <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
                        <!-- Error display -->
                        <Border Background="#FFEBEE" BorderBrush="#F44336" BorderThickness="1" 
                                Padding="5" CornerRadius="3" Margin="0,0,10,0"
                                Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="{Binding ErrorMessage}" Foreground="#D32F2F" FontWeight="Medium" FontSize="11"/>
                        </Border>
                        
                        <!-- Progress indicator -->
                        <StackPanel Orientation="Horizontal" 
                                   Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <ProgressBar Width="80" Height="14" IsIndeterminate="True" Margin="0,0,5,0"/>
                            <TextBlock Text="Loading..." FontSize="11" VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <TextBlock Text="{Binding StatusMessage}" FontSize="11" Foreground="Gray" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

            <!-- Pull Requests DataGrid -->
            <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredPullRequests}" 
                      SelectedItem="{Binding SelectedPullRequest}"
                      AutoGenerateColumns="False" IsReadOnly="True" 
                      GridLinesVisibility="All" HeadersVisibility="Column"
                      CanUserAddRows="False" CanUserDeleteRows="False" 
                      CanUserReorderColumns="True" CanUserResizeColumns="True"
                      CanUserSortColumns="True" SelectionMode="Single"
                      Style="{StaticResource FilterableDataGridStyle}"
                      x:Name="PullRequestsDataGrid">
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="📋 Open in Browser" Command="{Binding OpenInBrowserCommand}"/>
                        <MenuItem Header="📄 Copy URL" Command="{Binding CopyUrlCommand}"/>
                        <MenuItem Header="📁 Copy PR ID" Command="{Binding CopyPrIdCommand}"/>
                        <Separator/>
                        <MenuItem Header="🔄 Refresh" Command="{Binding RefreshCommand}"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60"/>
                    <DataGridTemplateColumn Header="Title" Width="300">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Hyperlink Click="TitleHyperlink_Click" Tag="{Binding}" 
                                               Foreground="#0066CC" 
                                               TextDecorations="Underline"
                                               Cursor="Hand"
                                               ToolTip="Click to open in browser">
                                        <TextBlock Text="{Binding Title}" TextWrapping="Wrap"/>
                                    </Hyperlink>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Status" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding StatusIcon}" FontSize="14" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Approval" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding ApprovalIcon}" FontSize="14" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding ApprovalStatusShort}" VerticalAlignment="Center" FontSize="11"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Created By" Binding="{Binding CreatedBy}" Width="150"/>
                    <DataGridTextColumn Header="Created Date" Width="120">
                        <DataGridTextColumn.Binding>
                            <Binding Path="CreatedDate" StringFormat="{}{0:yyyy/MM/dd}"/>
                        </DataGridTextColumn.Binding>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Source Branch" Binding="{Binding SourceBranch}" Width="150"/>
                    <DataGridTextColumn Header="Target Branch" Binding="{Binding TargetBranch}" Width="150"/>
                    <DataGridTextColumn Header="Modified Files" Binding="{Binding ModifiedFilesDisplay}" Width="300">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="TextWrapping" Value="Wrap"/>
                                <Setter Property="ToolTip" Value="{Binding ModifiedFilesDisplay}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
            </Grid>
            
            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                          Background="LightGray" ResizeBehavior="PreviousAndNext"/>
            
            <!-- PR Detail Pane -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                <StackPanel Margin="10" Visibility="{Binding IsDetailPaneVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="Pull Request Details" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                    
                    <!-- PR Header -->
                    <Border BorderBrush="LightGray" BorderThickness="1" Padding="10" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.Title}" FontWeight="Bold" FontSize="14" TextWrapping="Wrap" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.Id, StringFormat='#{0}'}" Foreground="Gray" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.Status, StringFormat='Status: {0}'}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.CreatedBy, StringFormat='Created by: {0}'}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.CreatedDate, StringFormat='Created: {0:yyyy/MM/dd HH:mm}'}" Foreground="Gray"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Description -->
                    <GroupBox Header="Description" Margin="0,0,0,10">
                        <TextBlock Text="{Binding SelectedPullRequest.Description}" TextWrapping="Wrap" MaxHeight="100" 
                                   Background="WhiteSmoke" Padding="5"/>
                    </GroupBox>
                    
                    <!-- Branches -->
                    <GroupBox Header="Branches" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.SourceBranch, StringFormat='From: {0}'}" Margin="0,0,0,2"/>
                            <TextBlock Text="↓" HorizontalAlignment="Center" Foreground="Gray"/>
                            <TextBlock Text="{Binding SelectedPullRequest.TargetBranch, StringFormat='To: {0}'}" Margin="0,2,0,0"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Status Information -->
                    <GroupBox Header="Status Information" Margin="0,0,0,10">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text="Build: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedPullRequest.BuildStatusIcon}"/>
                                <TextBlock Text="{Binding SelectedPullRequest.BuildStatus}" Margin="5,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text="Conflicts: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedPullRequest.ConflictIcon}"/>
                                <TextBlock Text="{Binding SelectedPullRequest.HasMergeConflicts, Converter={StaticResource ConflictStatusConverter}}" Margin="5,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Comments: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedPullRequest.CommentCount, StringFormat='💬 {0} total'}"/>
                                <TextBlock Text="{Binding SelectedPullRequest.UnresolvedCommentCount, StringFormat=', {0} unresolved'}" Margin="5,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Changes Summary -->
                    <GroupBox Header="Changes" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.ChangesSummary}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.ModifiedFilesDisplay}" TextWrapping="Wrap" Foreground="Gray" FontSize="12"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Reviewers -->
                    <GroupBox Header="Reviewers" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.ApprovalStatus}" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.ReviewersDisplay}" TextWrapping="Wrap"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Work Items -->
                    <GroupBox Header="Related Work Items" Margin="0,0,0,10">
                        <TextBlock Text="{Binding SelectedPullRequest.WorkItemsDisplay}" TextWrapping="Wrap"/>
                    </GroupBox>
                    
                    <!-- Actions -->
                    <GroupBox Header="Actions" Margin="0,0,0,10">
                        <StackPanel>
                            <Button Content="Open in Browser" Padding="5" Margin="0,0,0,5" 
                                    Command="{Binding OpenInBrowserCommand}"/>
                            <Button Content="Copy URL" Padding="5" 
                                    Command="{Binding CopyUrlCommand}"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
                </Grid>
            </DockPanel>
        </Border>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="4">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <Ellipse Width="8" Height="8" Margin="0,0,5,0">
                        <Ellipse.Fill>
                            <SolidColorBrush Color="{Binding IsConnected, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                        </Ellipse.Fill>
                    </Ellipse>
                    <TextBlock Text="{Binding StatusMessage, Mode=OneWay}"/>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right" Visibility="{Binding IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal">
                    <ProgressBar Width="100" Height="16" IsIndeterminate="True" Margin="0,0,5,0"/>
                    <TextBlock Text="Loading..." FontSize="11"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>