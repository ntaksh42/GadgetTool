<UserControl x:Class="GadgetTools.Plugins.PullRequestManagement.PullRequestManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:GadgetTools.Plugins.PullRequestManagement"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">
    
    <UserControl.Resources>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:BooleanInverseConverter x:Key="BooleanInverseConverter"/>
        <local:BooleanToColorConverter x:Key="BooleanToColorConverter"/>
        <local:BooleanToConnectionStatusConverter x:Key="BooleanToConnectionStatusConverter"/>
        <local:ConflictStatusConverter x:Key="ConflictStatusConverter"/>
        <local:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
        
        <!-- Expanderã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« -->
        <Style TargetType="Expander">
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <Style TargetType="Border" x:Key="ExpanderContentBorder">
            <Setter Property="BorderBrush" Value="#E1E1E1"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Background" Value="#FAFAFA"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,5,0,0"/>
        </Style>

        <!-- Custom TextBox style with lighter focus color -->
        <Style TargetType="TextBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                Background="{TemplateBinding Background}" 
                                SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Opacity" TargetName="border" Value="0.56"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="#7EB4EA"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="#A5D6FF"/>
                                <Setter Property="Background" TargetName="border" Value="#FAFDFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Custom Button style with lighter focus color -->
        <Style TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                Background="{TemplateBinding Background}" 
                                SnapsToDevicePixels="true">
                            <ContentPresenter x:Name="contentPresenter" 
                                              Focusable="False" 
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                              Margin="{TemplateBinding Padding}" 
                                              RecognizesAccessKey="True" 
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" 
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsDefaulted" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Background" TargetName="border" Value="#E3F2FD"/>
                                <Setter Property="BorderBrush" TargetName="border" Value="#90CAF9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="true">
                                <Setter Property="Background" TargetName="border" Value="#BBDEFB"/>
                                <Setter Property="BorderBrush" TargetName="border" Value="#42A5F5"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="#B3E5FC"/>
                                <Setter Property="Background" TargetName="border" Value="#F1F8FF"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Background" TargetName="border" Value="#FFF4F4F4"/>
                                <Setter Property="BorderBrush" TargetName="border" Value="#FFADB2B5"/>
                                <Setter Property="TextElement.Foreground" TargetName="contentPresenter" Value="#FF838383"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Custom ComboBox style with lighter focus color -->
        <Style TargetType="ComboBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid x:Name="templateRoot" SnapsToDevicePixels="true">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition MinWidth="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}" Width="0"/>
                            </Grid.ColumnDefinitions>
                            <Popup x:Name="PART_Popup" AllowsTransparency="true" Grid.ColumnSpan="2" IsOpen="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" Margin="1" PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}" Placement="Bottom">
                                <Border x:Name="dropDownBorder" BorderBrush="{DynamicResource {x:Static SystemColors.WindowFrameBrushKey}}" BorderThickness="1" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
                                    <ScrollViewer x:Name="DropDownScrollViewer">
                                        <Grid x:Name="grid" RenderOptions.ClearTypeHint="Enabled">
                                            <Canvas x:Name="canvas" HorizontalAlignment="Left" Height="0" VerticalAlignment="Top" Width="0">
                                                <Rectangle x:Name="opaqueRect" Fill="{Binding Background, ElementName=dropDownBorder}" Height="{Binding ActualHeight, ElementName=dropDownBorder}" Width="{Binding ActualWidth, ElementName=dropDownBorder}"/>
                                            </Canvas>
                                            <ItemsPresenter x:Name="ItemsPresenter" KeyboardNavigation.DirectionalNavigation="Contained" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </Grid>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                            <ToggleButton x:Name="toggleButton" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Grid.ColumnSpan="2" IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" Style="{DynamicResource ComboBoxToggleButton}"/>
                            <ContentPresenter x:Name="contentPresenter" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" Content="{TemplateBinding SelectionBoxItem}" ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" IsHitTestVisible="false" Margin="{TemplateBinding Padding}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasDropShadow" SourceName="PART_Popup" Value="true">
                                <Setter Property="Margin" TargetName="dropDownBorder" Value="0,2,0,0"/>
                            </Trigger>
                            <Trigger Property="HasItems" Value="false">
                                <Setter Property="Height" TargetName="dropDownBorder" Value="95"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsGrouping" Value="true"/>
                                    <Condition Property="VirtualizingPanel.IsVirtualizingWhenGrouping" Value="false"/>
                                </MultiTrigger.Conditions>
                                <Setter Property="ScrollViewer.CanContentScroll" TargetName="DropDownScrollViewer" Value="false"/>
                            </MultiTrigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="toggleButton" Value="#64B5F6"/>
                                <Setter Property="Background" TargetName="toggleButton" Value="#F0F8FF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" MinHeight="400"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Global Settings -->
        <Expander Grid.Row="0" Header="Global Settings" IsExpanded="True">
            <Border Style="{StaticResource ExpanderContentBorder}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- å…±é€šè¨­å®šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Azure DevOps Config:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                    <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,5">
                        <Ellipse Width="10" Height="10" Margin="0,0,5,0">
                            <Ellipse.Fill>
                                <SolidColorBrush Color="{Binding IsSharedConfigured, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                            </Ellipse.Fill>
                        </Ellipse>
                        <TextBlock Text="{Binding Organization, Mode=OneWay}" FontWeight="Medium" Margin="0,0,5,0"/>
                        <TextBlock Text="(" Foreground="Gray"/>
                        <TextBlock Text="{Binding IsSharedConfigured, Mode=OneWay, Converter={StaticResource BooleanToConnectionStatusConverter}}" Foreground="Gray"/>
                        <TextBlock Text=")" Foreground="Gray"/>
                    </StackPanel>
                    <Button Grid.Row="0" Grid.Column="2" Content="âš™ Configure" Width="100" Margin="5,0,0,5" 
                            Click="GlobalSettings_Click" ToolTip="Configure shared Azure DevOps settings"/>
                </Grid>
            </Border>
        </Expander>
        
        
        <!-- Actions and Filters -->
        <Expander Grid.Row="1" Header="Actions and Filters" IsExpanded="True">
            <Border Style="{StaticResource ExpanderContentBorder}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Project and Repository Row -->
                    <Grid Grid.Row="0" Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="Projects:" VerticalAlignment="Top" Margin="0,0,8,3"/>
                        <StackPanel Grid.Column="1" Margin="0,0,8,6">
                            <!-- Multi-selection Controls -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Multi-select display area -->
                                <Border Grid.Column="0" BorderBrush="#D1D1D1" BorderThickness="1" Background="White" 
                                         Padding="6,3" MinHeight="24" Margin="0,0,5,0">
                                    <Grid>
                                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                                            <ItemsControl ItemsSource="{Binding Projects}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel Orientation="Horizontal"/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="1" 
                                                                CornerRadius="12" Padding="6,2" Margin="0,0,3,2">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding}" FontSize="10" VerticalAlignment="Center"/>
                                                                <Button Content="Ã—" FontSize="9" FontWeight="Bold" 
                                                                        Background="Transparent" BorderThickness="0" 
                                                                        Foreground="#1976D2" Padding="2,0" Margin="3,0,0,0"
                                                                        ToolTip="Remove this project"
                                                                        Tag="{Binding}" Click="RemoveProject_Click"/>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>
                                        <!-- Placeholder text when empty -->
                                        <TextBlock Text="Click âŸ² to load projects from organization..." FontStyle="Italic" Foreground="#999" 
                                                   VerticalAlignment="Center" FontSize="10"
                                                   Visibility="{Binding Projects.Count, Converter={StaticResource ZeroToVisibilityConverter}}"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Load button -->
                                <Button Grid.Column="1" Content="âŸ²" Width="24" Height="24" FontSize="12" FontWeight="Bold"
                                        Background="#2196F3" Foreground="White" BorderThickness="0" Margin="0,0,3,0"
                                        ToolTip="Load projects from organization" Click="LoadProjects_Click"/>
                                
                                <!-- Add button -->
                                <Button Grid.Column="2" Content="+" Width="24" Height="24" FontSize="12" FontWeight="Bold"
                                        Background="#4CAF50" Foreground="White" BorderThickness="0"
                                        ToolTip="Add projects" Click="SelectProjects_Click"/>
                            </Grid>
                            
                            <!-- Legacy single project input (hidden) -->
                            <TextBox Text="{Binding Project}" Visibility="Collapsed" />
                        </StackPanel>
                        
                        <TextBlock Grid.Column="2" Text="Repositories:" VerticalAlignment="Top" Margin="0,0,8,3"/>
                        <StackPanel Grid.Column="3" Margin="0,0,0,6">
                            <!-- Multi-selection Controls -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Multi-select display area -->
                                <Border Grid.Column="0" BorderBrush="#D1D1D1" BorderThickness="1" Background="White" 
                                         Padding="6,3" MinHeight="24" Margin="0,0,5,0">
                                    <Grid>
                                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                                            <ItemsControl ItemsSource="{Binding Repositories}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel Orientation="Horizontal"/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#F3E5F5" BorderBrush="#9C27B0" BorderThickness="1" 
                                                                CornerRadius="10" Padding="6,2" Margin="0,0,3,2">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding}" FontSize="10" VerticalAlignment="Center"/>
                                                                <Button Content="Ã—" FontSize="9" FontWeight="Bold" 
                                                                        Background="Transparent" BorderThickness="0" 
                                                                        Foreground="#7B1FA2" Padding="2,0" Margin="3,0,0,0"
                                                                        ToolTip="Remove this repository"
                                                                        Tag="{Binding}" Click="RemoveRepository_Click"/>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>
                                        <!-- Placeholder text when empty -->
                                        <TextBlock Text="Click âŸ² to load repositories for selected projects..." FontStyle="Italic" Foreground="#999" 
                                                   VerticalAlignment="Center" FontSize="10"
                                                   Visibility="{Binding Repositories.Count, Converter={StaticResource ZeroToVisibilityConverter}}"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Load button -->
                                <Button Grid.Column="1" Content="âŸ²" Width="24" Height="24" FontSize="12" FontWeight="Bold"
                                        Background="#9C27B0" Foreground="White" BorderThickness="0" Margin="0,0,3,0"
                                        ToolTip="Load repositories for selected projects" Click="LoadRepositories_Click"/>
                                
                                <!-- Add button -->
                                <Button Grid.Column="2" Content="+" Width="24" Height="24" FontSize="12" FontWeight="Bold"
                                        Background="#9C27B0" Foreground="White" BorderThickness="0"
                                        ToolTip="Add repositories" Click="SelectRepositories_Click"/>
                            </Grid>
                            
                            <!-- Legacy single repository input (hidden) -->
                            <TextBox Text="{Binding Repository}" Visibility="Collapsed" />
                        </StackPanel>
                    </Grid>
                    
                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,6">
                        <Button Content="Load Pull Requests" Padding="8,3" Command="{Binding LoadPullRequestsCommand}"/>
                        <Button Content="Refresh" Padding="8,3" Margin="8,0,0,0" Command="{Binding RefreshCommand}"/>
                        
                    </StackPanel>
                    
                </Grid>
            </Border>
        </Expander>
        
        <!-- Results and Details -->
        <Border Grid.Row="2" BorderBrush="#D1D1D1" BorderThickness="1" Background="White" CornerRadius="4" Margin="0,0,0,10">
            <DockPanel>
                <Border DockPanel.Dock="Top" Background="#F5F5F5" BorderBrush="#D1D1D1" BorderThickness="0,0,0,1" Padding="15,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Pull Requests and Details" FontWeight="Bold" FontSize="14" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="â–² Collapse All" x:Name="CollapseAllButton" 
                                    Click="CollapseAll_Click" Margin="0,0,5,0" 
                                    Padding="8,3" FontSize="11" 
                                    ToolTip="Collapse all sections to maximize results area"/>
                            <Button Content="â–¼ Expand All" x:Name="ExpandAllButton" 
                                    Click="ExpandAll_Click" 
                                    Padding="8,3" FontSize="11"
                                    ToolTip="Expand all sections"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*" MinWidth="500"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="2*" MinWidth="350"/>
                    </Grid.ColumnDefinitions>
            
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Filter Controls -->
                <Grid Grid.Row="0" Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Filter:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Search in PR titles, descriptions, and author names"/>
                    <Button Grid.Column="2" Content="Clear" Width="50" 
                            Margin="5,0,0,0" Command="{Binding ClearAllFiltersCommand}"/>
                    <Button Grid.Column="3" Content="Clear Column Filters" Width="120" 
                            Margin="5,0,0,0" Command="{Binding ClearColumnFiltersCommand}"
                            ToolTip="Clear all column filters"/>
                    <Button Grid.Column="4" Content="Columns..." Width="80" 
                            Margin="5,0,0,0" Command="{Binding ShowColumnVisibilityCommand}"
                            ToolTip="Show/hide columns"/>
                    <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
                        <!-- Error display -->
                        <Border Background="#FFEBEE" BorderBrush="#F44336" BorderThickness="1" 
                                Padding="5" CornerRadius="3" Margin="0,0,10,0"
                                Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="{Binding ErrorMessage}" Foreground="#D32F2F" FontWeight="Medium" FontSize="11"/>
                        </Border>
                        
                        <!-- Progress indicator -->
                        <StackPanel Orientation="Horizontal" 
                                   Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <ProgressBar Width="80" Height="14" IsIndeterminate="True" Margin="0,0,5,0"/>
                            <TextBlock Text="Loading..." FontSize="11" VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <TextBlock Text="{Binding StatusMessage}" FontSize="11" Foreground="Gray" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

            <!-- Pull Requests DataGrid -->
            <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredPullRequests}" 
                      SelectedItem="{Binding SelectedPullRequest}"
                      AutoGenerateColumns="False" IsReadOnly="True" 
                      GridLinesVisibility="All" HeadersVisibility="Column"
                      CanUserAddRows="False" CanUserDeleteRows="False" 
                      CanUserReorderColumns="True" CanUserResizeColumns="True"
                      CanUserSortColumns="True" SelectionMode="Single"
                      Style="{StaticResource FilterableDataGridStyle}"
                      x:Name="PullRequestsDataGrid">
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="ðŸ“‹ Open in Browser" Command="{Binding OpenInBrowserCommand}"/>
                        <MenuItem Header="ðŸ“„ Copy URL" Command="{Binding CopyUrlCommand}"/>
                        <MenuItem Header="ðŸ“ Copy PR ID" Command="{Binding CopyPrIdCommand}"/>
                        <Separator/>
                        <MenuItem Header="ðŸ”„ Refresh" Command="{Binding RefreshCommand}"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60"/>
                    <DataGridTemplateColumn Header="Title" Width="300">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Hyperlink Click="TitleHyperlink_Click" Tag="{Binding}" 
                                               Foreground="#0066CC" 
                                               TextDecorations="Underline"
                                               Cursor="Hand"
                                               ToolTip="Click to open in browser">
                                        <TextBlock Text="{Binding Title}" TextWrapping="Wrap"/>
                                    </Hyperlink>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Status" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding StatusIcon}" FontSize="14" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Approval" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding ApprovalIcon}" FontSize="14" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding ApprovalStatusShort}" VerticalAlignment="Center" FontSize="11"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Created By" Binding="{Binding CreatedBy}" Width="150"/>
                    <DataGridTextColumn Header="Created Date" Width="120">
                        <DataGridTextColumn.Binding>
                            <Binding Path="CreatedDate" StringFormat="{}{0:yyyy/MM/dd}"/>
                        </DataGridTextColumn.Binding>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Source Branch" Binding="{Binding SourceBranch}" Width="150"/>
                    <DataGridTextColumn Header="Target Branch" Binding="{Binding TargetBranch}" Width="150"/>
                    <DataGridTextColumn Header="Modified Files" Binding="{Binding ModifiedFilesDisplay}" Width="300">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="TextWrapping" Value="Wrap"/>
                                <Setter Property="ToolTip" Value="{Binding ModifiedFilesDisplay}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
            </Grid>
            
            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                          Background="LightGray" ResizeBehavior="PreviousAndNext"/>
            
            <!-- PR Detail Pane -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                <StackPanel Margin="10" Visibility="{Binding IsDetailPaneVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="Pull Request Details" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                    
                    <!-- PR Header -->
                    <Border BorderBrush="LightGray" BorderThickness="1" Padding="10" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.Title}" FontWeight="Bold" FontSize="14" TextWrapping="Wrap" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.Id, StringFormat='#{0}'}" Foreground="Gray" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.Status, StringFormat='Status: {0}'}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.CreatedBy, StringFormat='Created by: {0}'}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.CreatedDate, StringFormat='Created: {0:yyyy/MM/dd HH:mm}'}" Foreground="Gray"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Description -->
                    <GroupBox Header="Description" Margin="0,0,0,10">
                        <TextBlock Text="{Binding SelectedPullRequest.Description}" TextWrapping="Wrap" MaxHeight="100" 
                                   Background="WhiteSmoke" Padding="5"/>
                    </GroupBox>
                    
                    <!-- Branches -->
                    <GroupBox Header="Branches" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.SourceBranch, StringFormat='From: {0}'}" Margin="0,0,0,2"/>
                            <TextBlock Text="â†“" HorizontalAlignment="Center" Foreground="Gray"/>
                            <TextBlock Text="{Binding SelectedPullRequest.TargetBranch, StringFormat='To: {0}'}" Margin="0,2,0,0"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Status Information -->
                    <GroupBox Header="Status Information" Margin="0,0,0,10">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text="Build: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedPullRequest.BuildStatusIcon}"/>
                                <TextBlock Text="{Binding SelectedPullRequest.BuildStatus}" Margin="5,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <TextBlock Text="Conflicts: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedPullRequest.ConflictIcon}"/>
                                <TextBlock Text="{Binding SelectedPullRequest.HasMergeConflicts, Converter={StaticResource ConflictStatusConverter}}" Margin="5,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Comments: " FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedPullRequest.CommentCount, StringFormat='ðŸ’¬ {0} total'}"/>
                                <TextBlock Text="{Binding SelectedPullRequest.UnresolvedCommentCount, StringFormat=', {0} unresolved'}" Margin="5,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Changes Summary -->
                    <GroupBox Header="Changes" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.ChangesSummary}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.ModifiedFilesDisplay}" TextWrapping="Wrap" Foreground="Gray" FontSize="12"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Reviewers -->
                    <GroupBox Header="Reviewers" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedPullRequest.ApprovalStatus}" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding SelectedPullRequest.ReviewersDisplay}" TextWrapping="Wrap"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- Work Items -->
                    <GroupBox Header="Related Work Items" Margin="0,0,0,10">
                        <TextBlock Text="{Binding SelectedPullRequest.WorkItemsDisplay}" TextWrapping="Wrap"/>
                    </GroupBox>
                    
                    <!-- Actions -->
                    <GroupBox Header="Actions" Margin="0,0,0,10">
                        <StackPanel>
                            <Button Content="Open in Browser" Padding="5" Margin="0,0,0,5" 
                                    Command="{Binding OpenInBrowserCommand}"/>
                            <Button Content="Copy URL" Padding="5" 
                                    Command="{Binding CopyUrlCommand}"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
                </Grid>
            </DockPanel>
        </Border>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <Ellipse Width="8" Height="8" Margin="0,0,5,0">
                        <Ellipse.Fill>
                            <SolidColorBrush Color="{Binding IsConnected, Mode=OneWay, Converter={StaticResource BooleanToColorConverter}}"/>
                        </Ellipse.Fill>
                    </Ellipse>
                    <TextBlock Text="{Binding StatusMessage, Mode=OneWay}"/>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right" Visibility="{Binding IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal">
                    <ProgressBar Width="100" Height="16" IsIndeterminate="True" Margin="0,0,5,0"/>
                    <TextBlock Text="Loading..." FontSize="11"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>