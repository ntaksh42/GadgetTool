<UserControl x:Class="GadgetTools.Core.Controls.ColumnFilter"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="250">
    
    <UserControl.Resources>
        <Style TargetType="TextBox" x:Key="SearchTextBoxStyle">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style TargetType="CheckBox" x:Key="FilterCheckBoxStyle">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <Style TargetType="Button" x:Key="FilterButtonStyle">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="3"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Setter Property="Background" Value="#F8F9FA"/>
        </Style>
    </UserControl.Resources>
    
    <Border BorderBrush="#D1D1D1" BorderThickness="1" Background="White" CornerRadius="4" 
            MinWidth="220" MaxWidth="300" MinHeight="200" MaxHeight="400">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <Border Grid.Row="0" Background="#F5F5F5" BorderBrush="#D1D1D1" BorderThickness="0,0,0,1" Padding="10,8">
                <TextBlock Text="{Binding ColumnName, StringFormat='Filter - {0}'}" FontWeight="Bold" FontSize="12"/>
            </Border>
            
            <!-- Search Box -->
            <TextBox Grid.Row="1" x:Name="SearchTextBox" 
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                     Style="{StaticResource SearchTextBoxStyle}"
                     ToolTip="Type to search values"/>
            
            <!-- Select All Options -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="5,0,5,5">
                <CheckBox Content="Select All" IsChecked="{Binding IsSelectAllChecked}" 
                          Style="{StaticResource FilterCheckBoxStyle}" FontWeight="Bold"/>
                <Button Content="Clear" Command="{Binding ClearAllCommand}" 
                        Style="{StaticResource FilterButtonStyle}" FontSize="11" Margin="10,2,2,2"/>
            </StackPanel>
            
            <!-- Values List -->
            <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" 
                          Margin="5,0,5,5">
                <ItemsControl ItemsSource="{Binding FilterValues}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected}" Style="{StaticResource FilterCheckBoxStyle}">
                                <CheckBox.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding DisplayValue}" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Count, StringFormat='({0})'}" 
                                                   Foreground="Gray" FontSize="10" Margin="5,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </CheckBox.Content>
                            </CheckBox>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            
            <!-- Action Buttons -->
            <Border Grid.Row="4" Background="#F5F5F5" BorderBrush="#D1D1D1" BorderThickness="0,1,0,0" Padding="5">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="OK" Command="{Binding ApplyFilterCommand}" 
                            Style="{StaticResource FilterButtonStyle}" IsDefault="True" 
                            Background="#007ACC" Foreground="White" FontWeight="Bold"/>
                    <Button Content="Cancel" Command="{Binding CancelFilterCommand}" 
                            Style="{StaticResource FilterButtonStyle}"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</UserControl>